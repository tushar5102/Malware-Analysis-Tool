import subprocess
import ctypes

def is_admin():
    try:
        return ctypes.windll.shell32.IsUserAnAdmin()
    except:
        return False

process_name = "powershell.exe"
process_list = subprocess.check_output(["tasklist", "/fi", "imagename eq "+process_name]).decode("utf-8")

for line in process_list.split("\n"):
    if process_name in line:
        pid = int(line.split()[1])
        if not is_admin():
            print("Stopping process with PID "+str(pid)+" as it does not have administrator privileges.")
            subprocess.call(["taskkill", "/F", "/PID",Â str(pid)])
